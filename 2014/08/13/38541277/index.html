<!DOCTYPE html>
<html lang="zh-CN">

  
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta name="author" content="è‘£æ²…é‘«, yuanxin.me@gmail.com">
  
  
  
  <title>Android WebViewä½¿ç”¨(ä¸€) | godeofdeath</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="æŠ€æœ¯ç¬”è®°,android,">
  

  <script>
    console.log('\n%c Hexo-theme-bmw v4.0 ' + '%c ğŸ‰ https://github.com/dongyuanxin/theme-bmw ğŸ‰\n' + '\n%c View demo online ' + '%c ğŸ” https://godbmw.com/ ğŸ”  \n' , 'color: #fadfa3; background: #030307; padding:3px 0;', '', 'color: #fadfa3; background: #030307; padding:3px 0;', '');
  </script>

  

  

  
    <link rel="icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/touch-icon.png">
  

  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/icon/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">

  <script src="/js/util.js"></script>
<script src="/js/valine.min.js"></script>

  

  
    <link href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js" async></script>
  

  
    <link href="https://cdn.bootcss.com/social-share.js/1.0.16/css/share.min.css" rel="stylesheet">
  
  
  <script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js" async></script>
  
  
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.11.0/dist/av-min.js"></script>
  

</head>

  <body>

    

    <div id="app">

      <div class="header-wrap">
  <header>
    <div class="site-brand">
      <div class="site-title">
        <a href="/">godofdeath&#39;s secret base</a>
      </div>
    </div>
    <nav class="site-navigation">
      <ul class="nav-menu">
      
        <li class="nav-item" data-path="/">
          
            <a href="/" target="_self">
              ä¸»é¡µ
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/archives/">
          
            <a href="/archives/" target="_self">
              å½’æ¡£
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/categories/">
          
            <a href="/categories/" target="_self">
              åˆ†ç±»
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/tags/">
          
            <a href="/tags/" target="_self">
              æ ‡ç­¾
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/friends/">
          
            <a href="/friends/" target="_self">
              å‹é“¾
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/about/">
          
            <a href="/about/" target="_self">
              å…³äº
            </a>
          
        </li>
      
        <li class="nav-item" data-path="">
          
            <a href="javascript:void(0);" v-else="">æŠ“åˆ°æˆ‘</a>
            <ul class="nav-menu--dropdown">
              
                <li>
                  <a href="https://github.com/godofdeath8080" target="_blank">
                    Github
                  </a>
                </li>
              
            </ul>
          
        </li>
      
      </ul>
    </nav>
    <i class="iconfont icon-menu"></i>
  </header>
</div>

<script>
  let links = document.querySelectorAll('.nav-item');
  for(let link of links){
    let childrenLink = link.querySelector('ul');
    link.addEventListener('mouseenter', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown active";
      }
    })
    link.addEventListener('mouseleave', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown";
      }
    })
  }
  let rootRealPath = getRealPath(window.location.pathname, true);
  for(let link of links) {
    let linkPath = link.getAttribute("data-path");
    if(linkPath && getRealPath(linkPath, true) === rootRealPath) {
      link.className = "nav-item hover";
    }
  }

  let iconMenu = document.querySelector("i.iconfont.icon-menu"),
    iconMenuClicked = false;
  let navDOM = document.querySelector("nav.site-navigation");
  iconMenu.addEventListener("click", () => {
    iconMenuClicked 
      ? navDOM.className = "site-navigation active"
      : navDOM.className = "site-navigation";
    iconMenuClicked = !iconMenuClicked;
  })
</script>

      








<div class="container post-index">

  

<div class="post">
  <h1 class="article-title">
    <span>Android WebViewä½¿ç”¨(ä¸€)</span>
  </h1>
  <div class="article-top-meta">
    <span>
      å‘å¸ƒ : 
      2014-08-13
    </span>
    
      <span>
        åˆ†ç±» : 
          <a href="/categories/æŠ€æœ¯ç¬”è®°/">
            æŠ€æœ¯ç¬”è®°
          </a>
      </span>
    
    
      <span>
        æµè§ˆ : <span class="article-timer" data-identity="38541277"></span>
      </span>
    
  </div>

  

  <div class="article-content">
    <div class="markdown-body">
      <p>æœ¬æ–‡ä¸»è¦å¯¹WebViewè¿›è¡Œä»‹ç»ï¼ŒåŒ…æ‹¬  webView 4ä¸ªå¯ä»¥å®šåˆ¶çš„ç‚¹  ã€  è®¾ç½®WebView backé”®å“åº”  ã€<br>æ§åˆ¶ç½‘é¡µçš„é“¾æ¥ä»åœ¨webViewä¸­è·³è½¬  ã€  æ˜¾ç¤ºé¡µé¢åŠ è½½è¿›åº¦  ã€  å¤„ç†httpsè¯·æ±‚  ã€<br>åˆ©ç”¨addJavascriptInterfaceå®ç°androidç¨‹åºå’Œjavascriptäº¤äº’  ç­‰ç­‰</p>
<p>WebViewåŸºäºwebkitå¼•æ“å±•ç°webé¡µé¢çš„æ§ä»¶ï¼Œä½¿ç”¨å‰éœ€è¦åœ¨Android Manifest<br>fileä¸­é…ç½®internetè®¿é—®æƒé™ï¼Œå¦åˆ™æç¤ºé¡µé¢æ— æ³•è®¿é—®</p>
<p>Xmlä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>&lt; uses-permission  android:name  =  â€œandroid.permission.INTERNETâ€  /&gt;</li>
</ol>
<p>WebViewæ§ä»¶åŠŸèƒ½å¼ºå¤§ï¼Œé™¤äº†å…·æœ‰ä¸€èˆ¬Viewçš„å±æ€§å’Œè®¾ç½®å¤–ï¼Œè¿˜å¯ä»¥å¯¹urlè¯·æ±‚ã€é¡µé¢åŠ è½½ã€æ¸²æŸ“ã€é¡µé¢äº¤äº’è¿›è¡Œå¼ºå¤§çš„å¤„ç†ã€‚</p>
<p>WebViewæœ‰å‡ ä¸ªå¯ä»¥å®šåˆ¶çš„ç‚¹ï¼š</p>
<p>ï¼ˆ1ï¼‰è®¾ç½® <a href="http://developers.androidcn.com/reference/android/we
bkit/WebChromeClient.html" target="_blank" rel="noopener"> WebChromeClient </a> å­ç±»ï¼Œ <strong> WebChromeClientä¼šåœ¨ä¸€äº›å½±å“æµè§ˆå™¨uiäº¤äº’åŠ¨ä½œå‘ç”Ÿæ—¶è¢«è°ƒç”¨ </strong><br>ï¼Œæ¯”å¦‚WebViewå…³é—­å’Œéšè—ã€é¡µé¢åŠ è½½è¿›å±•ã€jsç¡®è®¤æ¡†å’Œè­¦å‘Šæ¡†ã€jsåŠ è½½å‰ã€jsæ“ä½œè¶…æ—¶ã€webViewè·å¾—ç„¦ç‚¹ç­‰ç­‰ï¼Œè¯¦è§ <a href="http://developers.androidcn.com/reference/android/webkit/Web
ChromeClient.html" target="_blank" rel="noopener"><br>WebChromeClient </a></p>
<p>ï¼ˆ2ï¼‰è®¾ç½® <a href="http://developers.androidcn.com/reference/android/webkit/WebViewClient.html" target="_blank" rel="noopener"> WebViewClient
</a><br>å­ç±»ï¼Œ <strong> WebViewClientä¼šåœ¨ä¸€äº›å½±å“å†…å®¹å–§åš·çš„åŠ¨ä½œå‘ç”Ÿæ—¶è¢«è°ƒç”¨ </strong><br>ï¼Œæ¯”å¦‚è¡¨å•çš„é”™è¯¯æäº¤éœ€è¦é‡æ–°æäº¤ã€é¡µé¢å¼€å§‹åŠ è½½åŠåŠ è½½å®Œæˆã€èµ„æºåŠ è½½ä¸­ã€æ¥æ”¶åˆ°httpè®¤è¯éœ€è¦å¤„ç†ã€é¡µé¢é”®ç›˜å“åº”ã€é¡µé¢ä¸­çš„urlæ‰“å¼€å¤„ç†ç­‰ç­‰ï¼Œè¯¦è§ <a href="http://developers.androidcn.com/reference/android/webkit/WebViewClient.html" target="_blank" rel="noopener"><br>WebViewClient
</a></p>
<p>ï¼ˆ3ï¼‰è®¾ç½® <a href="http://developers.androidcn.com/reference/android/webkit/WebSettings.html" target="_blank" rel="noopener"> WebSettings
</a><br>ç±»ï¼Œ <strong> å…¶ä¸­åŒ…å«å¤šé¡¹é…ç½® </strong> ã€‚WebSettingsç”¨æ¥å¯¹WebViewçš„é…ç½®è¿›è¡Œé…ç½®å’Œç®¡ç†ï¼Œæ¯”å¦‚æ˜¯å¦å¯ä»¥è¿›è¡Œæ–‡ä»¶æ“ä½œã€ç¼“å­˜çš„è®¾ç½®ã€é¡µé¢æ˜¯å¦æ”¯æŒæ”¾å¤§<br>å’Œç¼©å°ã€æ˜¯å¦å…è®¸ä½¿ç”¨æ•°æ®åº“apiã€å­—ä½“åŠæ–‡å­—ç¼–ç è®¾ç½®ã€æ˜¯å¦å…è®¸jsè„šæœ¬è¿è¡Œã€æ˜¯å¦å…è®¸å›¾ç‰‡è‡ªåŠ¨åŠ è½½ã€æ˜¯å¦å…è®¸æ•°æ®åŠå¯†ç ä¿å­˜ç­‰ç­‰ï¼Œè¯¦è§ <a href="http://developers.androidcn.com/reference/android/webkit/WebSettings.html" target="_blank" rel="noopener"><br>WebSettings
</a></p>
<p>ï¼ˆ4ï¼‰è®¾ç½® <a href="http://developers.androidcn.com/reference/and
roid/webkit/WebView.html#addJavascriptInterface\(java.lang.Object,%20java.lang
.String\" target="_blank" rel="noopener"> addJavascriptInterface </a>) æ–¹æ³•ï¼Œ <strong> å°†javaå¯¹è±¡ç»‘å®šåˆ°webViewä¸­ï¼Œä»¥æ–¹ä¾¿ä»é¡µé¢jsä¸­æ§åˆ¶javaå¯¹è±¡ </strong> ï¼Œå®ç°ç”¨æœ¬åœ°javaä»£ç å’Œhtmlé¡µé¢è¿›<br>è¡Œäº¤äº’ï¼Œç”šè‡³å¯ä»¥è¿›è¡Œé¡µé¢è‡ªåŠ¨åŒ–ã€‚ä½†å¦‚æ­¤åšå­˜åœ¨å®‰å…¨éšæ‚£ï¼Œæ‰€ä»¥è‹¥è®¾ç½®äº†æ­¤æ–¹æ³•ï¼Œè¯·ç¡®ä¿webViewçš„ä»£ç éƒ½æ˜¯è‡ªå·±å®Œæˆï¼Œè¯¦ç»†ä½¿ç”¨addJavascriptInte<br>rfaceè¿›è¡Œè‡ªåŠ¨åŒ–è§æœ¬æ–‡5ä½¿ç”¨addJavascriptInterfaceå®Œæˆå’Œjsäº¤äº’</p>
<p><strong> 1ã€backé”®æ§åˆ¶ç½‘é¡µåé€€ </strong></p>
<p>Activityé»˜è®¤çš„backé”®å¤„ç†ä¸ºç»“æŸå½“å‰Activityï¼ŒwebViewæŸ¥çœ‹äº†å¾ˆå¤šç½‘é¡µåï¼Œå¸Œæœ›æŒ‰backé”®è¿”å›ä¸Šä¸€æ¬¡æµè§ˆçš„é¡µé¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦è¦†ç›–<br>onKeyDownå‡½æ•°ï¼Œå‘Šè¯‰ä»–å¦‚ä½•å¤„ç†ï¼Œå¦‚ä¸‹ï¼š</p>
<p>Javaä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>public  boolean  onKeyDown(  int  keyCode, KeyEvent event) { </li>
<li>if  (webView.canGoBack() &amp;&amp; event.getKeyCode() == KeyEvent.KEYCODE_BACK &amp;&amp; event.getRepeatCount() ==  0  ) { </li>
<li>webView.goBack(); </li>
<li>return  true  ; </li>
<li>} </li>
<li><ol start="7">
<li>return  super  .onKeyDown(keyCode, event); </li>
</ol>
</li>
<li>} </li>
</ol>
<p>å…¶ä¸­webView.canGoBack()åœ¨webViewå«æœ‰ä¸€ä¸ªå¯åé€€çš„æµè§ˆè®°å½•æ—¶è¿”å›true</p>
<p>webView.goBack();è¡¨ç¤ºè¿”å›webViewçš„ä¸Šæ¬¡è®¿é—®é¡µé¢</p>
<p><strong> 2ã€å½“å‰ç½‘é¡µçš„é“¾æ¥ä»åœ¨webViewä¸­è·³è½¬  </strong></p>
<p>Javaä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>webView.setWebViewClient(  new  WebViewClient() { </li>
<li><ol start="3">
<li>@Override </li>
</ol>
</li>
<li>public  boolean  shouldOverrideUrlLoading(WebView view, String url) { </li>
<li>view.loadUrl(url); </li>
<li>return  true  ; </li>
<li>} </li>
<li>}); </li>
</ol>
<p>shouldOverrideUrlLoadingè¡¨ç¤ºå½“å‰webViewä¸­çš„ä¸€ä¸ªæ–°urléœ€è¦åŠ è½½æ—¶ï¼Œç»™å½“å‰åº”ç”¨ç¨‹åºä¸€ä¸ªå¤„ç†æœºä¼šï¼Œå¦‚æœæ²¡æœ‰é‡å†™æ­¤å‡½æ•°ï¼ŒwebVi<br>ewè¯·æ±‚ActivityManageé€‰æ‹©åˆé€‚çš„æ–¹å¼å¤„ç†è¯·æ±‚ï¼Œå°±åƒå¼¹å‡ºucå’Œäº’è”ç½‘è®©ç”¨æˆ·é€‰æ‹©æµè§ˆå™¨ä¸€æ ·ã€‚é‡å†™åreturn<br>trueè¡¨ç¤ºè®©å½“å‰ç¨‹åºå¤„ç†ï¼Œreturn falseè¡¨ç¤ºè®©å½“å‰webViewå¤„ç†</p>
<p>Xmlä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>Give the host application a chance to take over the control when a new url is about to be loaded in the current WebView. If WebViewClient is not provided, by default WebView will ask Activity Manager to choose the proper handler for the url. If WebViewClient is provided, return true means the host application handles the url, while return false means the current WebView handles the url. </li>
</ol>
<p>å‚è€ƒï¼š</p>
<p><a href="http://devel
oper.android.com/reference/android/webkit/WebViewClient.html#shouldOverrideUrl
Loading\(android.webkit.WebView,%20java.lang.String\" target="_blank" rel="noopener"> http://developer.android.com/reference/android/webkit/WebViewClient.html#sho<br>uldOverrideUrlLoading(android.webkit.WebView, java.lang.String) </a>)</p>
<p>é—®é¢˜åˆ†æï¼š</p>
<p>ä»Šå¤©åœ¨ç”¨webView loadè…¾è®¯çš„OAuthé¡µé¢ <a href="http://open.t.qq.com/cgi-bin/authorize" target="_blank" rel="noopener"> http://open.t.qq.com/cgi-bin/authorize
</a></p>
<p>æ—¶ï¼Œçªç„¶å¼¹å‡ºé€‰æ‹©ucè¿˜æ˜¯äº’è”ç½‘æµè§ˆå™¨çš„ç¡®è®¤æ¡†ï¼Œå¾ˆå¥‡æ€ªï¼Œå…¶ä»–é¡µé¢éƒ½èƒ½æ­£å¸¸loadï¼Œè€Œè¿™ä¸ªå´æ— æ³•åœ¨webViewä¸­loadï¼Œåæ¥ç”¨ç«ç‹çœ‹äº†ä¸‹æ˜¯å› ä¸ºloadè¿™ä¸ªé¡µ<br>é¢çš„æ—¶å€™ä¼šé‡å®šå‘åˆ°å¦å¤–ä¸€ä¸ªé¡µé¢ <a href="http://open.t.qq.com/oauth_html/login.php?oauth_token=xxx&amp;type=0" target="_blank" rel="noopener"><br>http://open.t.qq.com/oauth_html/login.php?oauth_token=xxx&amp;type=0
</a> ï¼Œè€ŒwebViewæ²¡<br>æœ‰è®¾ç½®shouldOverrideUrlLoadingï¼Œå¯¼è‡´urläº¤ç»™äº†ActivityManageå»å¤„ç†ï¼Œè§£é‡Šå¦‚ä¸Šï¼Œåæ·»åŠ åå¯æ­£å¸¸loadé¡µé¢</p>
<p><strong> 3ã€é¡µé¢åŠ è½½è¿›åº¦  </strong></p>
<p>ä»£ç å¦‚ä¸‹</p>
<p>Javaä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>webView.setWebChromeClient(  new  WebChromeClient() { </li>
<li><ol start="3">
<li>public  void  onProgressChanged(WebView view,  int  progress) { </li>
</ol>
</li>
<li>setTitle(  â€œé¡µé¢åŠ è½½ä¸­ï¼Œè¯·ç¨å€™â€¦â€  + progress +  â€œ%â€  ); </li>
<li>setProgress(progress *  100  ); </li>
<li><ol start="7">
<li>if  (progress ==  100  ) { </li>
</ol>
</li>
<li>setTitle(R.string.app_name); </li>
<li>} </li>
<li>} </li>
<li>}); </li>
</ol>
<p>onProgressChangedé€šçŸ¥åº”ç”¨ç¨‹åºå½“å‰é¡µé¢åŠ è½½çš„è¿›åº¦</p>
<p>progress  è¡¨ç¤ºå½“å‰é¡µé¢åŠ è½½çš„è¿›åº¦ï¼Œä¸º1è‡³100çš„æ•´æ•°</p>
<p>å‚è€ƒï¼š</p>
<p><a href="http://developer.android.com/r
eference/android/webkit/WebChromeClient.html#onProgressChanged\(android.webkit
.WebView,%20int\" target="_blank" rel="noopener"> http://developer.android.com/reference/android/webkit/WebChromeClient.html#o<br>nProgressChanged(android.webkit.WebView, int) </a>)</p>
<p><strong> 4ã€å¤„ç†httpsè¯·æ±‚  </strong></p>
<p>webViewé»˜è®¤æ˜¯ä¸å¤„ç†httpsè¯·æ±‚çš„ï¼Œé¡µé¢æ˜¾ç¤ºç©ºç™½ï¼Œéœ€è¦è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼š</p>
<p>Javaä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>webView.setWebViewClient(  new  WebViewClient() { </li>
<li><ol start="3">
<li>@Override </li>
</ol>
</li>
<li>public  void  onReceivedSslError(WebView view, SslErrorHandler handler, SslError error) { </li>
<li>handler.proceed(); </li>
<li>//            handler.cancel(); </li>
<li>//            handler.handleMessage(null); </li>
<li>} </li>
<li>}); </li>
</ol>
<p>onReceivedSslErrorä¸ºwebViewå¤„ç†sslè¯ä¹¦è®¾ç½®</p>
<p>å…¶ä¸­handler.proceed();è¡¨ç¤ºç­‰å¾…è¯ä¹¦å“åº”</p>
<p>handler.cancel();è¡¨ç¤ºæŒ‚èµ·è¿æ¥ï¼Œä¸ºé»˜è®¤æ–¹å¼</p>
<p>handler.handleMessage(null);å¯åšå…¶ä»–å¤„ç†</p>
<p>å‚è€ƒï¼š</p>
<p><a href="http://developer.android.com/reference/android/we
bkit/WebViewClient.html#onReceivedSslError\(android.webkit.WebView,%20android.
webkit.SslErrorHandler,%20android.net.http.SslError\" target="_blank" rel="noopener"> http://developer.android.com/reference/android/webkit/WebViewClient.html#onR<br>eceivedSslError(android.webkit.WebView, android.webkit.SslErrorHandler,<br>android.net.http.SslError) </a>)</p>
<p><strong> 5ã€ä½¿ç”¨addJavascriptInterfaceå®Œæˆå’Œjsäº¤äº’  </strong></p>
<p><strong> 5.1 javascriptä¸­è°ƒç”¨javaå¯¹è±¡åŠæ–¹æ³• </strong></p>
<p>è®¾ç½®webViewçš„addJavascriptInterfaceæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¢«ç»‘å®šåˆ°jsä¸­çš„ç±»å®ä¾‹ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºåœ¨jsä¸­æš´éœ²çš„ç±»åˆ«å<br>ï¼Œåœ¨jsä¸­å¼•ç”¨javaå¯¹è±¡å°±æ˜¯ç”¨è¿™ä¸ªåå­—</p>
<p>Javaä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>ClassBeBindedToJS classBeBindedToJS =  new  ClassBeBindedToJS(); </li>
<li>webView.addJavascriptInterface(classBeBindedToJS,  â€œclassNameBeExposedInJsâ€  ); </li>
</ol>
<p>å®ç°ç»‘å®šåˆ°jsçš„ç±»ï¼Œå…¶ä¸­çš„javaMethodæ–¹æ³•æˆ‘ä»¬å°†åœ¨é¡µé¢å‰ç«¯jsä¸­è°ƒç”¨ï¼Œç”¨äºè¿”å›ä¸€æ®µå†…å®¹ã€‚  showHtmlç”¨æ¥ä½¿ç”¨<br>AlertDialogæ˜¾ç¤ºä¸€æ®µhtmlä»£ç ï¼Œç¨åå°†ä½¿ç”¨åˆ°</p>
<p>Javaä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>private  class  ClassBeBindedToJS{ </li>
<li>public  void  showHtml(String html){ </li>
<li>new  AlertDialog.Builder(UpdateStatusActivity.  this  ) </li>
<li>.setTitle(  â€œHTMLâ€  ).setMessage(html) </li>
<li>.setPositiveButton(android.R.string.ok,  null  ) </li>
<li>.setCancelable(  false  ).create().show(); </li>
<li>} </li>
<li>public  String javaMethod() { </li>
<li>return  â€œuse java methodâ€  ; </li>
<li>} </li>
<li>}; </li>
</ol>
<p>å¦‚æ­¤æˆ‘ä»¬å°±å¯ä»¥åœ¨å‰ç«¯è°ƒç”¨javaå¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</p>
<p>Htmlä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>&lt; span  &gt; &lt; html  &gt;</li>
<li>&lt; body  &gt;</li>
<li>&lt; div  id  =  â€œdisplayDivâ€  &gt; Test page.  &lt;/  div  &gt;</li>
<li>&lt; input  type  =  â€œbuttonâ€  value  =  â€œuse java objectâ€  onclick  =  â€œdocument.getElementById(â€˜displayDivâ€™).innerHTML=classNameBeExposedInJs.javaMethod()â€  /&gt;</li>
<li>&lt; span  &gt; &lt;/  body  &gt;</li>
<li>&lt;/  html  &gt; &lt;/  span  &gt;</li>
</ol>
<p>è¿™æ®µhtmlä½œç”¨ä¸ºç‚¹å‡»buttonæŒ‰é’®ï¼Œæ”¹å˜divå†…å®¹ä¸ºjavaå¯¹è±¡æ–¹æ³•ä¸­çš„å†…å®¹ï¼Œå…¶ä¸­classNameBeExposedInJsä¸ºjavaå¯¹è±¡åœ¨jsä¸­çš„åˆ«<br>åï¼Œ  javaMethodä¸ºjavaå¯¹è±¡çš„æ–¹æ³•</p>
<p><strong> 5.2 javaä¸­è°ƒç”¨jsæ–¹æ³• </strong></p>
<p>ç”¨webViewçš„loadUrlå®ç°ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬æƒ³åœ¨é¡µé¢åŠ è½½å®Œæˆåè°ƒç”¨jsä¸­çš„helloå‡½æ•°ï¼Œå®ç°å¦‚ä¸‹ï¼š</p>
<p>Javaä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>webView.setWebViewClient(  new  WebViewClient() { </li>
<li>@Override </li>
<li>public  void  onPageFinished(WebView webView, String url){ </li>
<li>webView.loadUrl(  â€œjavascript:hello()â€  ); </li>
<li>} </li>
<li>}); </li>
</ol>
<p>æ€ä¹ˆæ ·ï¼Œå¾ˆç®€å•å§^_^,ç›´æ¥loadUrl(â€œjavascript:hello()â€)å°±å¯ä»¥äº†</p>
<p>åˆ©ç”¨è¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°WebViewçš„è‡ªåŠ¨åŒ–ï¼Œå¦‚ç½‘é¡µè‡ªåŠ¨åŒ–ç™»å½•ã€‚ä¸¾ä¸ªæ —å­ï¼Œå®ç° <a href="http://m.renren.com/" target="_blank" rel="noopener"> http://m.renren.com/
</a> çš„è‡ªåŠ¨ç™»å½•å•Šï¼Œä»£ç å¦‚ä¸‹</p>
<p>Javaä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>webView.getSettings().setJavaScriptEnabled(  true  ); </li>
<li>webView.loadUrl(  â€œ<a href="http://m.renren.com&quot;" target="_blank" rel="noopener">http://m.renren.com&quot;</a>  ); </li>
<li>webView.requestFocus(); </li>
<li><ol start="5">
<li>ClassBeBindedToJS classBeBindedToJS =  new  ClassBeBindedToJS(); </li>
</ol>
</li>
<li>webView.addJavascriptInterface(classBeBindedToJS,  â€œclassNameBeExposedInJsâ€  ); </li>
<li>webView.setWebViewClient(  new  WebViewClient() { </li>
<li>@Override </li>
<li>public  void  onPageFinished(WebView webView, String url){ </li>
<li>webView.loadUrl(  â€œjavascript:document.getElementsByName(â€˜emailâ€™)[0].value=â€™userNameâ€™â€  ); </li>
<li>webView.loadUrl(  â€œjavascript:document.getElementsByName(â€˜passwordâ€™)[0].value=â€™userPasswordâ€™â€  ); </li>
<li>webView.loadUrl(  â€œjavascript:document.getElementsByName(â€˜loginâ€™)[0].click()â€  ); </li>
<li>} </li>
<li>}); </li>
</ol>
<p>ä»ä¸­å¯ä»¥çœ‹å‡ºå…ˆåŠ è½½  <a href="http://m.renren.comé¡µé¢ï¼Œåœ¨é¡µé¢åŠ è½½å®Œæˆ" target="_blank" rel="noopener">http://m.renren.comé¡µé¢ï¼Œåœ¨é¡µé¢åŠ è½½å®Œæˆ</a>  onPageFinishedåï¼Œè°ƒç”¨jså®ç°è‡ªåŠ¨ç™»å½•</p>
<p>å…¶ä¸­ä¸‰å¥jsåˆ†åˆ«è¡¨ç¤ºè®¾ç½®ç”¨æˆ·åæ–‡æœ¬æ¡†å†…å®¹ã€è®¾ç½®ç”¨æˆ·å¯†ç æ–‡æœ¬æ¡†å†…å®¹ã€ç‚¹å‡»ç™»å½•æŒ‰é’®ï¼Œå¦‚æ­¤ç™»å½•æˆåŠŸå–½</p>
<p><strong> 5.3 javaå’Œjsæ··ç”¨å®ç°ä¸€äº›æ•ˆæœ </strong></p>
<p><strong> 5.3.1 WebViewç”¨  AlertDialogæ˜¾ç¤ºé¡µé¢çš„htmlä»£ç   </strong></p>
<p>ä¹‹å‰5.1ä¸­çš„  showHtmlæ–¹æ³•ç°åœ¨æ´¾ä¸Šç”¨åœºå•¦ï¼Œåœ¨é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºé¡µé¢htmlå†…å®¹ï¼Œå¦‚ä¸‹ï¼š</p>
<p>Javaä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>webView.setWebViewClient(  new  WebViewClient() { </li>
<li>@Override </li>
<li>public  void  onPageFinished(WebView webView, String url){ </li>
<li>webView.loadUrl(  â€œjavascript:window.classNameBeExposedInJs.showHtml(document.getElementsByTagName(â€˜htmlâ€™)[0].innerHTML);â€  ); </li>
<li>} </li>
<li>}); </li>
</ol>
<p>å…¶ä¸­webView.loadUrlè¡¨ç¤ºè°ƒç”¨é¡µé¢ä¸­çš„jsï¼Œè€Œé¡µé¢ä¸­çš„js<br>window.classNameBeExposedInJs.showHtmlè°ƒç”¨äº†ç¨‹åºä¸­çš„javaå¯¹è±¡çš„æ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°ä¸ºä¸€æ®µjsã€‚</p>
<p>é¦–å…ˆwebViewä¼šæ‰§è¡Œè¿™ä¸€æ®µjs document.getElementsByTagName(â€˜htmlâ€™)[0].innerHTMLã€‚å«ä¹‰å³ä¸ºå–å¾—é¡µé¢ä¸­<br>htmlæ ‡è®°çš„innerHTMLï¼ŒåŠç½‘é¡µä¸»è¦å†…å®¹ï¼›</p>
<p>ç„¶åå°†å¾—åˆ°çš„ç½‘é¡µå†…å®¹å½“ä½œå­—ç¬¦ä¸²å‚æ•°ä¼ å…¥showHtmlæ–¹æ³•</p>
<p>æœ€åè°ƒç”¨showHtmlå‡½æ•°å®ç°ï¼Œå³ç”¨AlertDialogæ˜¾ç¤ºå­—ç¬¦ä¸²ï¼Œå¦‚æ­¤å¾—åˆ°äº†æ•´ä¸ªç½‘é¡µçš„å¤§éƒ¨åˆ†htmlä»£ç </p>
<p><strong> 5.3.2 WebViewæ˜¾ç¤ºå½“å‰é¡µé¢çš„urlåœ°å€ </strong></p>
<p>è·å¾—WebViewå½“å‰é¡µé¢urlä½¿ç”¨  webView.getUrl()å³å¯ï¼Œå¦‚ä¸‹ï¼š</p>
<p>Javaä»£ç  <a href="http://blog.csdn.net/vrix/article/details/7065110" target="_blank" rel="noopener"> <img src="http://trinea.iteye.com/images/icon_star.png" alt="æ”¶è—ä»£ç ">
</a></p>
<ol>
<li>webView.loadUrl(  â€œjavascript:window.classNameBeExposedInJs.showHtml(â€˜â€œ  + webView.getUrl() +  â€œâ€˜);â€  ); </li>
</ol>
<p>å‚è€ƒï¼š</p>
<p><a href="http://developer.android.com/reference/android/webkit/WebView.html" target="_blank" rel="noopener"> http://developer.android.com/reference/android/webkit/WebView.html
</a></p>
<p><a href="http://android.tgbus.com/Android/tutorial/201103/347674.shtml" target="_blank" rel="noopener"> http://android.tgbus.com/Android/tutorial/201103/347674.shtml
</a></p>

    </div>
  </div>
  
    <div class="copy-right">
      <div class="markdown-body">
        <blockquote>
        
        
          æœ¬æ–‡ä½œè€… : godofdeath <br>
        
        åŸæ–‡é“¾æ¥ : <a href="">https://godeofdeath8080.github.io/2014/08/13/38541277/</a><br>
        ç‰ˆæƒå£°æ˜ : æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
        </blockquote>
      </div>
    </div>
  
  
  
    <div class="social-share" style="margin-top: -2rem" data-wechat-qrcode-title="<p>å¾®ä¿¡æ‰«ä¸€æ‰«</p>" data-wechat-qrcode-helper="<p>å¾®ä¿¡å³ä¸Šè§’, æ‰«ä¸€æ‰«åˆ†äº«</p>" data-sites="qzone, qq, weibo, wechat, douban, google, facebook, twitter">
  <span style="color: #6b7487; font-size: 1.4rem;">åˆ†äº«åˆ°: </span>
</div>
<script src="https://cdn.bootcss.com/social-share.js/1.0.16/js/social-share.min.js" async></script>
  

  
    <div id="reward">
  
    <p id="reward-meta">çŸ¥è¯† & æƒ…æ€€ | äºŒè€…å…¼å¾—</p>
  
  <button id="reward-btn">
    
    <span>æŠ•é£Ÿ</span>
  </button>
  <div id="reward-qrcode">
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/wechat.png" alt="å¾®ä¿¡æ‰«ä¸€æ‰«, å‘æˆ‘æŠ•é£Ÿ">
        <p class="qrcode-meta">å¾®ä¿¡æ‰«ä¸€æ‰«, å‘æˆ‘æŠ•é£Ÿ</p>
      </div>
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/alipay.png" alt="æ”¯ä»˜å®æ‰«ä¸€æ‰«, å‘æˆ‘æŠ•é£Ÿ">
        <p class="qrcode-meta">æ”¯ä»˜å®æ‰«ä¸€æ‰«, å‘æˆ‘æŠ•é£Ÿ</p>
      </div>
    
  </div>

</div>

<script>
  (() => {
    let button = document.querySelector('#reward-btn'),
      qrcode = document.querySelector('#reward-qrcode'),
      display = false;
    
    button.addEventListener('click', () => {
      qrcode.style.display = display ? 'none' : 'block'
      display = !display
    }, false)
  })()
</script>
  

  <div class="article-footer">
    <div class="article-meta pull-left">
      <span>
        
          <i class="iconfont icon-06tags"></i>æ ‡ç­¾: 
          
          <span class="span--tag">
            <a href="/tags/android/">
              #android
            </a>
          </span>
          
        
      </span>
    </div>
    <div class="article-meta pull-right">
    </div>
  </div>
</div>


  <aside id="sidebar">
    <p id="sidebar-header"></p>
    <ol id="sidebar-toc"></ol>
  </aside>
  <script async>setTimeout(generateToc, 10);</script>


  <nav class="post-navigation">
    
      <div class="nav-pre">
        <i class="iconfont icon-prev"></i>
        ä¸Šä¸€ç¯‡:
        <a href="/2014/07/22/38048353/" target="_self">ä½¿ç”¨Vitamioæ’­æ”¾rtspæµåª’ä½“å¹¶å®ç°åŠ¨æ€æˆªå›¾</a>
      </div>
    
    
      <div class="nav-next">
        ä¸‹ä¸€ç¯‡:
        <a href="/2014/08/13/38541367/" target="_self">Android å¢é‡æ›´æ–°å®ä¾‹ï¼ˆSmart App Updatesï¼‰</a>
        <i class="iconfont icon-next"></i>
      </div>
    
  </nav>

  
    <a href="#comment" class="comment-anchor"></a>
<div class="comment-title"><i class="iconfont icon-footprint"></i> ç•™ä¸‹è¶³è¿¹ <i class="iconfont icon-footprint"></i></div>
<div id="vcomments"></div>

<script defer>
  if( true ) {
    let path = getRealPath()
    new Valine({
      el: "#vcomments",
      appId: "ItM6mbdojuyLn6btoS3R6328-gzGzoHsz",
      appKey: "4RAiCQV3jQP7gC1ahBU0xKnA",
      notify: false,
      verify: false,
      avatar: "robohash",
      placeholder: "æ­£ç¡®å¡«å†™é‚®ç®±, æ‰èƒ½åŠæ—¶æ”¶åˆ°å›å¤å“¦â™ª(^âˆ‡^*)",
      path
    });
  }
</script>
   

  
    <script defer>
const valineAPI = (() => {
  try {
    AV.init("ItM6mbdojuyLn6btoS3R6328-gzGzoHsz", "4RAiCQV3jQP7gC1ahBU0xKnA");
  } catch(error) {}
  const isExist = (identity) => {
    identity = identity || getRealPath();
    let query = new AV.Query('Timer');
    return new Promise((resolve, reject) => {
      query.equalTo("identity", identity);
      query.find().then(results => {
        resolve(results.length > 0);
      }, error => reject(error));
    })
  }

  const _get = (identity) => {
    let query = null;
    if(identity && identity instanceof Array){
      let querys = [];
      for(let i = 0; i < identity.length; ++i) {
        querys[i] = new AV.Query('Timer');
        querys[i].equalTo('identity', identity[i]);
      }
      query = AV.Query.or.apply(null ,querys);
    } else {
      identity = identity || getRealPath();
      query = new AV.Query("Timer");
      query.equalTo("identity", identity);
    }

    return new Promise((resolve, reject) => {
      query.find()
      .then(results => resolve(results))
      .catch(error => reject(error))
    })
  }

  const create = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let Todo = AV.Object.extend('Timer');
      let todo = new Todo();
      todo.set("times", 1);
      todo.set("identity", identity);
      todo.save().then(res => resolve(true), error => reject(error));
    })
  }

  const update = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let query = new AV.Query('Timer');
      query.equalTo("identity", identity);
      query.find().then(todos => {
        todos.forEach(todo => {
          todo.set("times", todo.attributes.times + 1);
        });
        return AV.Object.saveAll(todos);
      }).then(todos => resolve(true), error => reject(error));
    })
  }

  return {
    isExist,
    _get,
    update,
    create
  }
})()

const calcAndWriteTimes = () => {
  let isPost = true;

  let timerAllDOM = document.querySelectorAll(".article-timer");

  if(isPost) {
    let identity = timerAllDOM[0].getAttribute("data-identity");
    valineAPI.isExist(identity)
    .then(exist => {
      if(exist) {
        return valineAPI.update(identity);
      }
      return new Promise(resolve => resolve(true));
    })
    .then( succuess => valineAPI._get(identity))
    .then( result => timerAllDOM[0].innerText = result[0].attributes.times)
    .catch(error => console.log(error.message))
    return ;
  }

  let timerDOMCache = {};

  for(let timerDOM of timerAllDOM) {
    let identity = timerDOM.getAttribute("data-identity");
    if(timerDOMCache.hasOwnProperty(identity)){
      timerDOMCache[identity].dom.push(timerDOM);
    }else{
      timerDOMCache[identity] = {
        dom: [timerDOM],
        times: undefined
      };
    }
  }

  let identities = Object.keys(timerDOMCache);
  valineAPI._get(identities).then(results => {
    for(let result of results) {
      let {identity, times} = result.attributes;
      timerDOMCache[identity].times = times;
      timerDOMCache[identity].dom.map(item => item.innerText = times);
    }
    for(let identity of identities) {
      if(timerDOMCache[identity].times){
        continue;
      }
      timerDOMCache[identity].dom.map(item => item.innerText = 1);
      valineAPI.create(identity);
    }
  }).catch(error => console.log(error.message))
}

if(true){
  calcAndWriteTimes();
}
</script>
   

</div>


      <footer>
  <p class="site-info">
    åšå®¢å·²èŒèŒå“’è¿è¡Œ<span id="time-to-now"></span><span class="my-face">(â—'â—¡'â—)ï¾‰â™¥</span>
    <br>
    Theme - <a href="https://github.com/dongyuanxin/theme-bmw">BMW</a> | Made With ğŸ’— | Powered by <a href="https://godbmw.com/">GodBMW</a>
    <br>
    
  </p>
</footer>



<script>
const timeToNowDOM = document.querySelector("#time-to-now");
const startTimestamp = new Date(2018, 1, 10).getTime();

const updateTimeStr = () => {
  let offset = parseInt(
      (new Date().getTime() - startTimestamp) / 1000,
      10
    ),
    day = Math.floor(offset / 86400),
    hour = Math.floor((offset % 86400) / 3600),
    minute = Math.floor(((offset % 86400) % 3600) / 60),
    second = Math.floor(((offset % 86400) % 3600) % 60);
  timeToNowDOM.innerHTML =
    day + "å¤©" + hour + "å°æ—¶" + minute + "åˆ†é’Ÿ" + second + "ç§’";
  setTimeout(updateTimeStr, 500);
}

setTimeout(updateTimeStr, 500);
</script>


      <div class="back-to-top hidden">
  <span>
    <i class="iconfont icon-60"></i><span></span>%
  </span>
</div>

<script>
const updateIconToTop = percent => {
  let dom = document.querySelector(".back-to-top span span");
  dom.innerText = percent;
  if(percent < 1) {
    document.querySelector(".back-to-top").className = "back-to-top hidden";
  } else {
    document.querySelector(".back-to-top").className = "back-to-top";
  }
}

const handleScoll = () => {
  let isRunning = false;
  return () => {
    if (isRunning) return;
    isRunning = true;
    window.requestAnimationFrame(timestamp => {
      let scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop,
        scrollHeight =
          document.documentElement.scrollHeight ||
          document.body.scrollHeight,
        clientHeight =
          document.documentElement.clientHeight ||
          document.body.clientHeight;
      isRunning = false;
      if (scrollTop <= 1) {
        updateIconToTop(0);
        return;
      }
      if (scrollTop + clientHeight >= scrollHeight) {
        updateIconToTop(100);
      } else {
        updateIconToTop(parseInt(
          100 * scrollTop / (scrollHeight - clientHeight),
          10
        ));
      }
    });
  };
}

const backToTop = () => {
  let scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop,
    delay = 10,
    time = 200;
  if (scrollTop <= 20) {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    return;
  }
  let step = Math.ceil(scrollTop * delay / time);
  let timer = setInterval(() => {
    scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop;
    if (scrollTop - step <= 0) {
      document.documentElement.scrollTop = 0;
      document.body.scrollTop = 0;
      clearInterval(timer);
    } else {
      document.documentElement.scrollTop = scrollTop - step;
      document.body.scrollTop = scrollTop - step;
    }
  }, delay);
}

document.addEventListener("scroll", handleScoll(), false);

document.querySelector(".back-to-top").addEventListener("click", backToTop, false);

</script>

    </div>

    
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  (() => {
    const mathjaxConfig = {
      showProcessingMessages: false, //å…³é—­jsåŠ è½½è¿‡ç¨‹ä¿¡æ¯
      messageStyle: "none", //ä¸æ˜¾ç¤ºä¿¡æ¯
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]], //è¡Œå†…å…¬å¼é€‰æ‹©ç¬¦
        displayMath: [["$$", "$$"], ["\\[", "\\]"]], //æ®µå†…å…¬å¼é€‰æ‹©ç¬¦
        skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //é¿å¼€æŸäº›æ ‡ç­¾
      },
      "HTML-CSS": {
        availableFonts: ["STIX", "TeX"], //å¯é€‰å­—ä½“
        showMathMenu: false //å…³é—­å³å‡»èœå•æ˜¾ç¤º
      }
    }

    let mathjaxInterval = setInterval(() => {
      if(!window.MathJax){
        return;
      }
      window.MathJax.Hub.Config(mathjaxConfig)
      window.MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.getElementById('app')])

      clearInterval(mathjaxInterval)
    }, 10)    
  })()
</script>
    

    <script src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script>
<script async>
  let fancyTimer = setInterval(function(){
    if(!window.$){
      return;
    }
    $(document).ready(function() {
      $(".post img").each(function () {
        if($(this).parent().get(0).tagName.toLowerCase() === "a") {
          return;
        }
        // $(this).attr("data-fancybox", "gallery"); // if you add 'data-fancybox', img will display after showed
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "gallery");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      });
      
      clearInterval(fancyTimer);
    });
  }, 10);
</script>

    
  </body>

</html>
